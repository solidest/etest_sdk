
## 简介

- SDK为使用ETestDev进行二次开发的开发程序包
- SDK中为开发上位机程序和开发测试程序提供API支持

### 入口函数
- 测试程序的入口函数名必须为 `entry`
- 入口函数接收2个参数，`vars`、`option`,分别用于用例输入参数值，和用户自定义选项


## Outer API
ETest与外部交互使用的API，主要目的是供UI程序集成时使用

#### makeenv

-  创建项目执行环境

#### start 

- 启动执行项目内的一个测试程序

#### stop

- 强制停止测试程序的执行

#### state

- 查询当前etest执行器的状态

#### readout

- 读取执行器的输出数据

## Inner API

ETest内部执行用到的API，主要目的是开发测试程序时使用

### 内置对象

- `protocol` 包含项目内已定义的全部协议
- `device` 包含当前拓扑环境中的全部设备
- `record` 包含用例执行中的全局记录
- `data` 包含用例执行中的全局数据


### 基础库

#### print

- 命令行输出文本信息
- 输入参数可变数量
- 任意类型的数据均转为文本输出

#### exit

- 退出测试程序执行

#### assert

- 执行断言，第一个参数为fasle时退出程序
- 第二个参数为可选的断言失败时的提示信息

#### verify

- 执行判定，并返回判定结果，但不退出程序
- 第二个参数为可选的判定失败时的提示信息

#### delay

- 延时指定的 ms 时间

#### now

- 返回测试程序自启动至当前时长
- 默认返回时长单位是 ms
- 输入可选字符串参数 'ms' 或 'us' 或 'ns' 指定时长单位

#### error

- 输出一个错误对象
- 测试程序会自动退出

#### warn

- 输出警告信息
- 测试程序不会自动退出

#### message

- 用指定协议的创建消息
- 第二个可选参数用于初始化消息内容

#### pack

- pack(msg) 将消息打包
- pack(protocol.xxx, data) 使用指定协议打包数据
- 返回值是打包后的buffer

#### unpack

- unpack(protocol.xxx, buffer) 使用指定协议解包buffer
- 返回解包后的结果数据

### string库

#### string.hex

- 将buffer转为16进制字符串，以用于阅读输出

#### string.buf

- 将16进制字符串转为buffer，以用于通信使用

#### string.byte

- 输出字符串的内部编码
- 输入参数依次为字符串，要输出的开始索引[i]、结束索引[j]
- 默认i=1，j=i

#### string.char

- 输出和参数数量相同长度的字符串
- 参数为零或者更多的整数
- 每个字符的内部编码值等于对应的参数值

#### string.dump

- 输出包含有以二进制方式表示的（一个 二进制代码块 ）指定函数的字符串
- 之后可以用 load 调用这个字符串获得 该函数的副本（但是绑定新的上值）
- 参数1为function， 如果参数2可选，如果为真值， 二进制代码块不携带该函数的调试信息 （局部变量名，行号，等等）

#### string.find

- 查找参数1(字符串)中匹配到的参数2 （参见 §6.4.1）。 
- 如果找到一个匹配，find 会返回参数1中关于它起始及终点位置的索引； 否则，返回 nil 
- 第三个可选数字参数指明从哪里开始搜索； 默认值为 1 ，同时可以是负值
- 第四个可选参数为 true 时， 关闭模式匹配机制， 此时函数仅做直接的 “查找子串”的操作， 而参数2中没有字符被看作魔法字符 
- 注意，如果给定了参数4　，就必须写上参数3

#### string.format

- 输出不定数量参数的格式化版本， 格式化串为第一个参数（必须是一个字符串）
- 格式化字符串遵循 ISO C 函数 sprintf 的规则，不同点在于选项 *, h, L, l, n, p 不支持， 另外还增加了一个选项 q， q 选项将一个字符串格式化为两个双引号括起，对内部字符做恰当的转义处理的字符串该字符串可以安全的被 Lua 解释器读回来
- 例如，调用string.format('%q', 'a string with "quotes" and \n new line')
会产生字符串："a string with \"quotes\" and \new line"

#### string.gmatch

- 输出一个迭代器函数， 每次调用这个函数都会继续以参数2对参数1做匹配，并返回所有捕获到的值 
- 如果参数2中没有指定捕获，则每次捕获整个参数2

#### string.gsub

- 将参数1(字符串)中，所有的（或是在参数4给出时的前参数4(参数4为可选参数)个）参数2都替换成参数3 ，并输出
- 参数3 可以是字符串、表、或函数，gsub 还会在第二个返回值返回一共发生了多少次匹配
- 如果参数3是一个字符串，那么把这个字符串作为替换品。 字符 % 是一个转义符：
- 参数3中的所有形式为 %d 的串表示 第 d 个捕获到的子串，d可以是1到9，串%0表示整个匹配，串%%表示单个%
- 如果参数3是张表，每次匹配时都会用第一个捕获物作为键去查这张表
- 如果参数3是个函数，则在每次匹配发生时都会调用这个函数,所有捕获到的子串依次作为参数传入
- 任何情况下，模板中没有设定捕获都看成是捕获整个模板
- 如果表的查询结果或函数的返回结果是一个字符串或是个数字， 都将其作为替换用串； 而在返回 false 或 nil　时不作替换 （即保留匹配前的原始串）

#### string.len

- 参数为一个字符串
- 输出其长度
- 空串 "" 的长度为 0 
- 内嵌零也统计在内，因此 "a\000bc\000" 的长度为 5 

#### string.lower

- 参数为一个字符串
- 将其中的大写字符都转为小写后输出
- 其它的字符串不会更改，对大写字符的定义取决于当前的区域设置

#### string.match

- 在参数1(字符串)中找到第一个能用参数2匹配到的部分
- 如果能找到，输出其中的捕获物； 否则返回 nil 
- 如果参数2中未指定捕获， 输出整个参数2捕获到的串
- 第三个可选数字参数，指明从哪里开始搜索； 它默认为1，可以是负数

#### string.pack 

- 输出一个打包了（即以二进制形式序列化） 参数2, 参数3等值的二进制字符串
- 参数1(字符串)为打包格式

#### string.packsize

- 输出以指定格式用 string.pack 打包的字符串的长度
- 格式化字符串中不可以有变长选项 's' 或 'z'

#### string.rep

- 输出 参数2(正数) 个参数1(参数1) 以参数3(字符串)为分割符连在一起的字符串
- 默认的参数3值为空字符串（即没有分割符）
- 如果参数2不是正数则返回空串

#### string.reverse

- 输出字符串的翻转串
- 输入参数为字符串

#### string.sub

- 输出参数1的子串， 该子串从参数2开始到参数3为止； 参数2 和 参数3 都可以为负数。 如果不给出参数3 ，就当它是 -1 （和字符串长度相同） 
- 调用 string.sub(参数1,1,参数3) 可以返回参数1的长度为参数3 的前缀串， 而 string.sub(参数1, -参数2) 返回长度为参数2的后缀串。
- 如果在对负数索引转义后参数2小于 1 的话，就修正回 1  
- 如果参数3比字符串的长度还大，就修正为字符串长度 
- 如果在修正之后，参数2大于参数3， 函数返回空串。

#### string.unpack

- 输出以格式参数1打包在参数2(字符串)中的值
- 选项参数3（默认为 1 ）标记了从参数2中哪里开始读起。 读完所有的值后，函数返回参数2中第一个未读字节的位置。

#### string.upper

- 输入参数为一个字符串 
- 将其中的小写字符都转为大写后输出 
- 其它的字符串不会更改，对小写字符的定义取决于当前的区域设置

### math库

#### math.abs 

- 输出参数的绝对值(integer/float)

#### math.acos 

- 输出参数的反余弦值（用弧度表示）

#### math.asin

- 输出参数的反正弦值（用弧度表示）

#### math.atan

- 输出 参数1/参数2（参数2为可选参数）的反正切值（用弧度表示）。 
- 它会使用两个参数的符号来找到结果落在哪个象限中（即使参数2为零时，也可以正确的处理）
- 默认的参数2是 1 ，因此调用 math.atan(参数1) 将返回参数1的反正切值

#### math.ceil

- 输出不小于参数的最小整数值

#### math.cos

- 输出参数的余弦（假定参数是弧度）

#### math.deg 

- 将角 参数 从弧度转换为角度

#### math.exp

- 输出 e的x次方(假定参数为x) 的值（e 为自然对数的底）

#### math.floor 

- 输出不大于参数的最大整数值

#### math.fmod 

- 返回参数1除以参数2，将商向零圆整后的余数。 (integer/float)

#### math.huge

- 浮点数 HUGE_VAL， 这个数比任何数字值都大

#### math.log

- 返回以指定底的 参数1 的对数，默认的参数2是e（因此此函数返回参数1 的自然对数）

#### math.max 

- 返回参数中最大的值， 大小由 Lua 操作 < 决定(integer/float)

#### math.maxinteger

- 最大值的整数

#### math.min 

- 输出参数中最小的值， 大小由 Lua 操作 < 决定(integer/float)

#### math.mininteger

- 最小值的整数

#### math.modf

- 输出参数的整数部分和小数部分，第二个结果一定是浮点数

#### math.pi

- π 的值

#### math.rad

- 将角 (参数) 从角度转换为弧度

#### math.random

- 当不带参数调用时， 返回一个 [0,1) 区间内一致分布的浮点伪随机数。 
- 当以两个整数 m 与 n 调用时， math.random 返回一个 [m, n] 区间 内一致分布的整数为随机数（值 n-m 不能是负数，且必须在 Lua 整数的表示范围内）
- 调用 math.random(n) 等价于 math.random(1,n)
- 这个函数是对 C 提供的位随机数函数的封装。 对其统计属性不作担保

#### math.randomseed 

- 把 参数 设为伪随机数发生器的“种子”： 相同的种子产生相同的随机数列

#### math.sin

- 输出参数的正弦值（假定参数是弧度）

#### math.sqrt

- 输出参数的平方根（你也可以使用乘方 参数^0.5 来计算这个值）

#### math.tan

- 输出参数的正切值（假定参数是弧度）

#### math.tointeger 

- 如果参数可以转换为一个整数， 返回该整数 否则返回 nil

#### math.type 

- 如果参数是整数，返回 "integer" 
- 如果是浮点数，返回 "float"
- 如果不是数字，返回 nil

#### math.ult

- 如果整数参数1和 参数2 以无符号整数形式比较， 参数1在 参数2 之下，返回布尔真否则返回假

#### math.isequal(f1, f2, is_double)

- 判定两个浮点数是否相等
- 第三个可选参数为布尔型，true：double方式比较， false：float方式比较
- 默认按float方式比较


